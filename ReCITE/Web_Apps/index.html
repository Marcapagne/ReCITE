<html>

<head>
    <title>Kuya Wheel</title>
    <link rel="stylesheet" href="main.css" type="text/css" />
    <script type="text/javascript" src="Winwheel.js"></script>
    <script type="text/javascript" src="Winwheel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <div align="center">
        <table cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td width="438" height="582" class="the_wheel" align="center" valign="center">
                    <canvas onclick="startSpin();" id="canvas" width="434" height="434">
                        <p style="{color: white}" align="center">Sorry, your browser doesn't support canvas. Please try
                            another.</p>
                    </canvas>
                </td>
            </tr>
        </table>
    </div>


    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-dialog modal-dialog-centered">
                You motherfucker won! <span id="student"></span>
              </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="draw()">Close</button>
            </div>
          </div>
        </div>

        <button id="modal"></button>
      </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBHcokPUxsadjWEnRugBcjSZERODdTnPVo",
            authDomain: "curriculum-9f921.firebaseapp.com",
            databaseURL: "https://curriculum-9f921-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "curriculum-9f921",
            storageBucket: "curriculum-9f921.appspot.com",
            messagingSenderId: "850351009105",
            appId: "1:850351009105:web:b8a53325f995a656cb7770",
            measurementId: "G-X5NRSY58F5"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();
        var ref = database.ref('studentData/Class1');

        let data = [];

        ref.on('value', function (snapshot) {
            snapshot.forEach(element => {
                var item = {
                    'fillStyle': "#7de6ef",
                    'text': element.val().name
                }
                segments.push(item);
                draw()
            });
        });


        function addData() {
            var data = {
                name: "SSS",
                socre: 232
            }
            ref.push(data);
        }

        function gotData() {

        }


        //  SAMPLE PALANG TO tanggalin yung ibang yan pag mdarami na laman ng data
        let segments = [{
                'fillStyle': '#7de6ef',
                'text': 'Prize 1'
            },
            {
                'fillStyle': '#7de6ef',
                'text': 'Prize 2'
            }
        ];

        let theWheel = new Winwheel();

        function draw() {
            theWheel = new Winwheel({
                'numSegments': segments.length, // Specify number of segments.
                'outerRadius': 212, // Set outer radius so wheel fits inside the background.
                'textFontSize': 28, // Set font size as desired.
                'segments': segments,
                'animation': // Specify the animation to use.
                {
                    'type': 'spinToStop',
                    'duration': 15,
                    'spins': 8,
                    'callbackFinished': alertPrize,
                    'callbackSound': playSound, // Function to call when the tick sound is to be triggered.
                    'soundTrigger': 'pin' // Specify pins are to trigger the sound, the other option is 'segment'.
                },
                'pins': {
                    'number': 20 // Number of pins. They space evenly around the wheel.
                }
            });
        }

        let audio = new Audio('tick.mp3'); // Create audio object and load tick.mp3 file.

        function playSound() {
            audio.pause();
            audio.currentTime = 0;
            audio.play();
        }

        function alertPrize(indicatedSegment) {
            document.getElementById('student').innerHTML = indicatedSegment.text;
            $("#exampleModal").modal('show');
            segments.splice(segments.indexOf(indicatedSegment), 1);
        }

        let wheelPower = 0;
        let wheelSpinning = false;

        function powerSelected(powerLevel) {
            if (wheelSpinning == false) {
                wheelPower = powerLevel;
            }
        }

        function startSpin() {
            if (wheelSpinning == false) {

                theWheel.animation.spins = 8;
                theWheel.startAnimation();
                wheelSpinning = true;
            }
        }

        function resetWheel() {
            theWheel.stopAnimation(false); // Stop the animation, false as param so does not call callback function.
            theWheel.rotationAngle = 0; // Re-set the wheel angle to 0 degrees.
            theWheel.draw(); // Call draw to render changes to the wheel.
            wheelSpinning = false; // Reset to false to power buttons and spin can be clicked again.
        }
    </script>
</body>

</html>